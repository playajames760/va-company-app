{% extends 'base.html' %}
{% block content %}
<div class="mb-4 p-4 bg-white rounded shadow-sm">
  <div class="mb-3">
    <h1 class="h2 mb-1 fw-bold">ğŸ›ï¸ Operations Console</h1>
    <p class="text-muted mb-0 small">Real-time operational metrics and recent activity</p>
  </div>
  {% if app_settings and app_settings.show_workflow_help %}
    {% include '_flow_help.html' %}
  {% endif %}
  <div class="row g-3 mt-2">
    <div class="col-sm-6 col-md-4 col-lg-3">
      <a href="{{ url_for('economy_ledger') }}" class="text-decoration-none text-reset">
      <div class="stat-card border rounded p-3 text-center clickable-stat">
        <div class="text-success mb-1">ğŸ’µ</div>
        <div class="small text-muted mb-1">Completed Profit</div>
        <div class="h3 mb-0 fw-bold text-success">${{ '%.0f'|format(completed_profit) }}</div>
      </div>
      </a>
    </div>
    <div class="col-sm-6 col-md-4 col-lg-3">
      <a href="{{ url_for('economy_ledger') }}" class="text-decoration-none text-reset">
      <div class="stat-card border rounded p-3 text-center clickable-stat">
        <div class="text-primary mb-1">ğŸ“Š</div>
        <div class="small text-muted mb-1">Net Profit</div>
        <div class="h3 mb-0 fw-bold text-primary">${{ '%.0f'|format(net_profit) }}</div>
      </div>
      </a>
    </div>
    <div class="col-sm-6 col-md-4 col-lg-3">
      <a href="{{ url_for('cargo_history') }}" class="text-decoration-none text-reset">
      <div class="stat-card border rounded p-3 text-center clickable-stat">
        <div class="text-info mb-1">ğŸ“¦</div>
        <div class="small text-muted mb-1">Cargo Manifests</div>
        <div class="h3 mb-0 fw-bold">{{ counts.cargo_manifests }}</div>
      </div>
      </a>
    </div>
    <div class="col-sm-6 col-md-4 col-lg-3">
      <a href="{{ url_for('dispatch_history') }}" class="text-decoration-none text-reset">
      <div class="stat-card border rounded p-3 text-center clickable-stat">
        <div class="text-warning mb-1">ğŸ“‹</div>
        <div class="small text-muted mb-1">Dispatch Releases</div>
        <div class="h3 mb-0 fw-bold">{{ counts.dispatch_releases }}</div>
      </div>
      </a>
    </div>
    <div class="col-sm-6 col-md-4 col-lg-3">
      <a href="{{ url_for('crew_history') }}" class="text-decoration-none text-reset">
      <div class="stat-card border rounded p-3 text-center clickable-stat">
        <div class="text-secondary mb-1">ğŸ‘¥</div>
        <div class="small text-muted mb-1">Crew Logs</div>
        <div class="h3 mb-0 fw-bold">{{ counts.crew_logs }}</div>
      </div>
      </a>
    </div>
    <div class="col-sm-6 col-md-4 col-lg-3">
      <a href="{{ url_for('incident_history') }}" class="text-decoration-none text-reset">
      <div class="stat-card border rounded p-3 text-center clickable-stat">
        <div class="text-danger mb-1">âš ï¸</div>
        <div class="small text-muted mb-1">Open Incidents</div>
        <div class="h3 mb-0 fw-bold">{{ counts.incidents }}</div>
      </div>
      </a>
    </div>
    <div class="col-sm-6 col-md-4 col-lg-3">
      <a href="{{ url_for('notams_history') }}" class="text-decoration-none text-reset">
      <div class="stat-card border rounded p-3 text-center clickable-stat">
        <div class="mb-1">ğŸ“¢</div>
        <div class="small text-muted mb-1">NOTAMs</div>
        <div class="h3 mb-0 fw-bold">{{ counts.company_notams }}</div>
      </div>
      </a>
    </div>
    <div class="col-sm-6 col-md-4 col-lg-3">
      <a href="{{ url_for('fleet_history') }}" class="text-decoration-none text-reset">
      <div class="stat-card border rounded p-3 text-center clickable-stat">
        <div class="mb-1">âœˆï¸</div>
        <div class="small text-muted mb-1">Fleet Aircraft</div>
        <div class="h3 mb-0 fw-bold">{{ counts.fleet_entries }}</div>
      </div>
      </a>
    </div>
  </div>
</div>

<div class="row g-4">
  <div class="col-md-6">
    <div class="bg-white rounded shadow-sm p-3">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h2 class="h5 mb-0">ğŸ“¦ Recent Cargo Manifests</h2>
        <a href="{{ url_for('cargo') }}" class="btn btn-sm btn-primary">+ New</a>
      </div>
      <div class="table-responsive">
        <table class="table table-sm table-hover align-middle mb-0">
          <thead class="pra-thead"><tr><th>Date</th><th>Flight</th><th>Aircraft</th><th>Weight</th></tr></thead>
          <tbody>
          {% for m in manifests %}
            <tr class="clickable-row" onclick="window.location='{% if m.dispatch_release_id %}{{ url_for('dispatch_detail', id=m.dispatch_release_id) }}{% else %}{{ url_for('cargo_detail', id=m.id) }}{% endif %}'">
              <td>{{ m.date }}</td>
              <td>{{ m.flight_id }}</td>
              <td>{{ m.aircraft }}</td>
              <td>{{ m.total_weight }}</td>
            </tr>
          {% else %}
            <tr><td colspan="4" class="text-muted">No manifests.</td></tr>
          {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
  <div class="col-md-6">
    <div class="bg-white rounded shadow-sm p-3">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h2 class="h5 mb-0">ğŸ“‹ Recent Dispatch Releases</h2>
        <a href="{{ url_for('dispatch') }}" class="btn btn-sm btn-primary">+ New</a>
      </div>
      <div class="table-responsive">
        <table class="table table-sm table-hover align-middle mb-0">
          <thead class="pra-thead"><tr><th>Date</th><th>Flight</th><th>Aircraft</th><th>Route</th></tr></thead>
          <tbody>
          {% for d in releases %}
            <tr class="clickable-row" onclick="window.location='{{ url_for('dispatch_detail', id=d.id) }}'">
              <td>{{ d.date }}</td>
              <td>{{ d.flight_id }}</td>
              <td>{{ d.aircraft }}</td>
              <td>{{ d.route[:20] }}{% if d.route|length > 20 %}â€¦{% endif %}</td>
            </tr>
          {% else %}
            <tr><td colspan="4" class="text-muted">No releases.</td></tr>
          {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
  <div class="col-md-6">
    <div class="bg-white rounded shadow-sm p-3">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h2 class="h5 mb-0">ğŸ‘¥ Recent Crew Logs</h2>
        <a href="{{ url_for('crew') }}" class="btn btn-sm btn-primary">+ New</a>
      </div>
      <div class="table-responsive">
        <table class="table table-sm table-hover align-middle mb-0">
          <thead class="pra-thead"><tr><th>Date</th><th>Flight</th><th>Aircraft</th><th>Block Time</th></tr></thead>
          <tbody>
          {% for c in logs %}
            <tr class="clickable-row" onclick="window.location='{% if c.dispatch_release_id %}{{ url_for('dispatch_detail', id=c.dispatch_release_id) }}{% else %}{{ url_for('crew_detail', id=c.id) }}{% endif %}'">
              <td>{{ c.date }}</td>
              <td>{{ c.flight_id }}</td>
              <td>{{ c.aircraft }}</td>
              <td>{{ c.block_time }}</td>
            </tr>
          {% else %}
            <tr><td colspan="4" class="text-muted">No crew logs.</td></tr>
          {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
  <div class="col-md-6">
    <div class="bg-white rounded shadow-sm p-3">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h2 class="h5 mb-0">ğŸ“¢ Recent Company NOTAMs</h2>
        <a href="{{ url_for('notams') }}" class="btn btn-sm btn-primary">+ New</a>
      </div>
      <div class="table-responsive">
        <table class="table table-sm table-hover align-middle mb-0">
          <thead class="pra-thead"><tr><th>ID</th><th>Subject</th><th>Status</th></tr></thead>
          <tbody>
          {% for n in notams %}
            <tr class="clickable-row" onclick="window.location='{{ url_for('notam_detail', id=n.id) }}'">
              <td>{{ n.notam_id }}</td>
              <td>{{ n.subject }}</td>
              <td>{{ n.status }}</td>
            </tr>
          {% else %}
            <tr><td colspan="3" class="text-muted">No NOTAMs.</td></tr>
          {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
  <div class="col-md-6">
    <div class="bg-white rounded shadow-sm p-3">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h2 class="h5 mb-0">âš ï¸ Recent Incidents</h2>
        <a href="{{ url_for('incident') }}" class="btn btn-sm btn-danger">+ Report</a>
      </div>
      <div class="table-responsive">
        <table class="table table-sm table-hover align-middle mb-0">
          <thead class="pra-thead"><tr><th>Date</th><th>Title</th><th>Severity</th><th>Cost</th></tr></thead>
          <tbody>
          {% for inc in incidents %}
            <tr class="clickable-row" onclick="window.location='{{ url_for('incident_detail', id=inc.id) }}'">
              <td>{{ inc.date }}</td>
              <td>{{ inc.title }}</td>
              <td>{{ inc.severity }}</td>
              <td>${{ '%.0f'|format(inc.estimated_cost or 0.0) }}</td>
            </tr>
          {% else %}
            <tr><td colspan="4" class="text-muted">No incidents.</td></tr>
          {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
  <div class="col-12">
    <div class="bg-white rounded shadow-sm p-3">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h2 class="h5 mb-0">âœˆï¸ Fleet Aircraft</h2>
        <a href="{{ url_for('fleet') }}" class="btn btn-sm btn-primary">+ New</a>
      </div>
      <div class="table-responsive">
        <table class="table table-sm table-hover align-middle mb-0">
          <thead class="pra-thead"><tr><th>Registration</th><th>Type</th><th>Base</th><th>Status</th><th>MTOW</th><th>Useful Load</th></tr></thead>
          <tbody>
          {% for f in fleet_entries %}
            <tr class="clickable-row" onclick="window.location='{{ url_for('fleet_detail', id=f.id) }}'">
              <td>{{ f.registration }}</td>
              <td>{{ f.aircraft_type }}</td>
              <td>{{ f.base }}</td>
              <td>{{ f.status }}</td>
              <td>{{ f.max_takeoff_weight }}</td>
              <td>{{ f.useful_load }}</td>
            </tr>
          {% else %}
            <tr><td colspan="6" class="text-muted">No fleet entries.</td></tr>
          {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
{% endblock %}
