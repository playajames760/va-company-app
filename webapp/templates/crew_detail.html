{% extends 'base.html' %}
{% block content %}
<div class="p-4 bg-white rounded shadow-sm">
  <div class="d-flex justify-content-between align-items-center mb-2">
    <h2 class="mb-0">Crew Log #{{ c.id }} – {{ c.flight_id }}</h2>
    <div class="btn-group btn-group-sm">
      <a href="{{ url_for('crew_history') }}" class="btn btn-outline-secondary">History</a>
      <a href="{{ url_for('crew_edit', id=c.id) }}" class="btn btn-outline-warning">Edit</a>
      <form action="{{ url_for('delete_crew', id=c.id) }}" method="post" class="d-inline" onsubmit="return confirm('Delete this crew log entry?');">
        <button class="btn btn-outline-danger btn-sm">Delete</button>
      </form>
    </div>
  </div>
  {% if c.dispatch_release_id %}
    <div class="alert alert-info small mb-3">Linked to Dispatch Release <a href="{{ url_for('dispatch_detail', id=c.dispatch_release_id) }}" class="alert-link">#{{ c.dispatch_release_id }}</a>.</div>
  {% endif %}
  {% if c.cargo_manifest_id %}
    <div class="alert alert-secondary small mb-3">Related Cargo Manifest <a href="{{ url_for('cargo_detail', id=c.cargo_manifest_id) }}" class="alert-link">#{{ c.cargo_manifest_id }}</a>.</div>
  {% endif %}
  <dl class="row mb-0">
    <dt class="col-sm-3">Date</dt><dd class="col-sm-9">{{ c.date }}</dd>
    <dt class="col-sm-3">Flight ID</dt><dd class="col-sm-9">{{ c.flight_id }}</dd>
    <dt class="col-sm-3">Origin</dt><dd class="col-sm-9">{{ c.origin }}</dd>
    <dt class="col-sm-3">Destination</dt><dd class="col-sm-9">{{ c.destination }}</dd>
    <dt class="col-sm-3">Aircraft</dt><dd class="col-sm-9">{{ c.aircraft }}</dd>
    <dt class="col-sm-3">Block Off</dt><dd class="col-sm-9">{{ c.block_off }}</dd>
    <dt class="col-sm-3">Block On</dt><dd class="col-sm-9">{{ c.block_on }}</dd>
    <dt class="col-sm-3">Block Time</dt><dd class="col-sm-9">{{ c.block_time }}</dd>
    <dt class="col-sm-3">Cargo Weight (lbs)</dt><dd class="col-sm-9">{{ c.cargo_weight }}</dd>
    <dt class="col-sm-3">Fuel Used</dt><dd class="col-sm-9">{{ c.fuel_used or '—' }}</dd>
    <dt class="col-sm-3">Remarks</dt><dd class="col-sm-9"><pre class="small bg-light p-2 border rounded" style="white-space:pre-wrap">{{ c.remarks }}</pre></dd>
  </dl>
  <div class="mt-4">
    <h3 class="h6">Sign-Offs</h3>
    <hr class="my-3">
    <div>
      <h5 class="h6 mb-2">Crew Log Sign-Offs</h5>
      {% if signoffs and signoffs|length > 0 %}
        <ul class="list-unstyled small mb-2">
          {% for so in signoffs %}
            <li class="mb-1">✍️ {{ so.employee.name }} ({{ so.employee.role }}) – {{ so.timestamp.strftime('%Y-%m-%d %H:%MZ') }}</li>
          {% endfor %}
        </ul>
      {% else %}
        <p class="small text-muted mb-2">No sign-offs yet.</p>
      {% endif %}
      {% if current_employee %}
        <form method="post" action="{{ url_for('crew_sign', id=c.id) }}" class="d-inline">
          <button class="btn btn-outline-success btn-sm" {% if signoffs and signoffs|selectattr('employee_id','equalto', current_employee.id)|list|length > 0 %}disabled{% endif %}>Sign Crew Log</button>
        </form>
      {% else %}
        <a href="{{ url_for('login') }}" class="btn btn-outline-primary btn-sm">Login to sign</a>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}