{% extends 'base.html' %}
{% block content %}
<div class="p-4 bg-white rounded shadow-sm">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h2 class="mb-0">Application Settings</h2>
    <a href="{{ url_for('index') }}" class="btn btn-outline-secondary">Back to Dashboard</a>
  </div>
  <p class="text-muted small mb-4">Configure your company branding, difficulty level, and realism parameters.</p>

  <form method="post" enctype="multipart/form-data">
    <!-- Company Branding -->
    <div class="card mb-4" style="border-color: var(--bs-border-color);">
      <div class="card-header" style="background-color: rgba(13, 110, 253, 0.08); border-bottom: 1px solid var(--bs-border-color);">
        <h3 class="h6 mb-0">üèõÔ∏è Company Branding</h3>
      </div>
      <div class="card-body">
        <div class="row g-3">
          <div class="col-md-6">
            <label class="form-label">Company Name</label>
            <input type="text" name="company_name" class="form-control" value="{{ settings.company_name }}" placeholder="Palm Route Air">
            <div class="form-text">Displayed in navbar and throughout the app.</div>
          </div>
          <div class="col-md-6">
            <label class="form-label">Company Logo (optional)</label>
            <input type="file" name="logo_file" class="form-control" accept="image/*">
            <div class="form-text">
              {% if settings.logo_filename %}
                Current: <a href="{{ url_for('static', filename='logos/' + settings.logo_filename) }}" target="_blank">{{ settings.logo_filename }}</a>
              {% else %}
                No logo uploaded. Upload PNG, JPG, or SVG (recommended: 48x48px or scalable).
              {% endif %}
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Game Difficulty -->
    <div class="card mb-4" style="border-color: var(--bs-border-color);">
      <div class="card-header" style="background-color: rgba(13, 110, 253, 0.08); border-bottom: 1px solid var(--bs-border-color);">
        <h3 class="h6 mb-0">üéÆ Difficulty & Realism</h3>
      </div>
      <div class="card-body">
        <div class="row g-3">
          <div class="col-md-6">
            <label class="form-label">Difficulty Level</label>
            <select name="difficulty" class="form-select">
              <option value="Easy" {% if settings.difficulty == 'Easy' %}selected{% endif %}>Easy - Higher profits, minimal penalties</option>
              <option value="Normal" {% if settings.difficulty == 'Normal' %}selected{% endif %}>Normal - Balanced gameplay</option>
              <option value="Hard" {% if settings.difficulty == 'Hard' %}selected{% endif %}>Hard - Lower profits, stricter penalties</option>
              <option value="Realistic" {% if settings.difficulty == 'Realistic' %}selected{% endif %}>Realistic - Maximum realism & challenges</option>
            </select>
            <div class="form-text">Affects profit margins and operational penalties.</div>
          </div>
          <div class="col-md-3">
            <label class="form-label">Revenue Variance (¬±%)</label>
            <input type="number" step="0.01" min="0" max="0.5" name="realism_fuel_variance" class="form-control" value="{{ settings.realism_fuel_variance }}">
            <div class="form-text">Random profit fluctuation (0.05 = ¬±5%).</div>
          </div>
          <div class="col-md-3">
            <label class="form-label">Destination Miss Penalty (%)</label>
            <input type="number" step="0.01" min="0" max="1" name="realism_destination_penalty" class="form-control" value="{{ settings.realism_destination_penalty }}">
            <div class="form-text">Penalty if flight doesn't reach planned destination (0.25 = 25%).</div>
          </div>
        </div>
        <div class="alert alert-info py-2 mt-3 small mb-0">
          <strong>Difficulty Effects:</strong>
          <ul class="mb-0 mt-1">
            <li><strong>Easy:</strong> +20% base revenue, 10% destination penalty, ¬±2% variance</li>
            <li><strong>Normal:</strong> Standard revenue, 25% penalty, ¬±5% variance (default)</li>
            <li><strong>Hard:</strong> -10% base revenue, 35% penalty, ¬±8% variance</li>
            <li><strong>Realistic:</strong> -20% base revenue, 50% penalty, ¬±10% variance, fuel reconciliation strictly enforced</li>
          </ul>
        </div>
      </div>
    </div>

    <!-- Display Preferences -->
    <div class="card mb-4" style="border-color: var(--bs-border-color);">
      <div class="card-header" style="background-color: rgba(13, 110, 253, 0.08); border-bottom: 1px solid var(--bs-border-color);">
        <h3 class="h6 mb-0">üìä Display Preferences</h3>
      </div>
      <div class="card-body">
        <div class="row g-3">
          <div class="col-md-4">
            <label class="form-label">Currency Symbol</label>
            <input type="text" name="currency_symbol" class="form-control" value="{{ settings.currency_symbol }}" maxlength="5" placeholder="$">
            <div class="form-text">Shown for all monetary amounts.</div>
          </div>
          <div class="col-md-4">
            <label class="form-label">Distance Unit</label>
            <select name="distance_unit" class="form-select">
              <option value="NM" {% if settings.distance_unit == 'NM' %}selected{% endif %}>Nautical Miles (NM)</option>
              <option value="KM" {% if settings.distance_unit == 'KM' %}selected{% endif %}>Kilometers (KM)</option>
            </select>
          </div>
          <div class="col-md-4">
            <label class="form-label">Weight Unit</label>
            <select name="weight_unit" class="form-select">
              <option value="lbs" {% if settings.weight_unit == 'lbs' %}selected{% endif %}>Pounds (lbs)</option>
              <option value="kg" {% if settings.weight_unit == 'kg' %}selected{% endif %}>Kilograms (kg)</option>
            </select>
          </div>
        </div>
        <div class="row g-3 mt-2">
          <div class="col-12">
            <div class="form-check">
              <input class="form-check-input" type="checkbox" name="show_workflow_help" id="show_workflow_help" {% if settings.show_workflow_help %}checked{% endif %}>
              <label class="form-check-label" for="show_workflow_help">
                Show Operational Workflow help on dashboard
              </label>
              <div class="form-text">Display the workflow guide card on the Operations Console.</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Save Button -->
    <div class="d-flex justify-content-between align-items-center">
      <a href="{{ url_for('index') }}" class="btn btn-outline-secondary">Cancel</a>
      <div>
        <button type="button" class="btn btn-danger me-2" data-bs-toggle="modal" data-bs-target="#resetGameModal">üîÑ Reset Game</button>
        <button type="submit" class="btn btn-primary">üíæ Save Settings</button>
      </div>
    </div>
  </form>
</div>

<!-- Reset Game Modal -->
<div class="modal fade" id="resetGameModal" tabindex="-1" aria-labelledby="resetGameModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header bg-danger text-white">
        <h5 class="modal-title" id="resetGameModalLabel">‚ö†Ô∏è Reset Game</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <form method="post" action="{{ url_for('reset_game') }}">
        <div class="modal-body">
          <div class="alert alert-warning">
            <strong>Warning:</strong> This will permanently delete all game data including:
            <ul class="mb-0 mt-2">
              <li>All dispatch releases and cargo manifests</li>
              <li>All crew logs and flight records</li>
              <li>All fleet entries and NOTAMs</li>
              <li>All transactions and financial history</li>
              <li>All incidents</li>
            </ul>
          </div>
          
          <div class="alert alert-info">
            <strong>Note:</strong> Your settings (company name, difficulty, etc.) will be preserved.
          </div>
          
          <div class="form-check">
            <input class="form-check-input" type="radio" name="seed_data" id="seed_yes" value="yes" checked>
            <label class="form-check-label" for="seed_yes">
              <strong>Start with sample data</strong>
              <div class="small text-muted">Includes 3 aircraft, 2 flights, sample cargo, and crew logs</div>
            </label>
          </div>
          
          <div class="form-check mt-2">
            <input class="form-check-input" type="radio" name="seed_data" id="seed_no" value="no">
            <label class="form-check-label" for="seed_no">
              <strong>Start with clean slate</strong>
              <div class="small text-muted">Empty database - build everything from scratch</div>
            </label>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-danger">Reset Game</button>
        </div>
      </form>
    </div>
  </div>
</div>
{% endblock %}
